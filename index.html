
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Illume Feedback Survey</title>
<style>
  :root { --bg:#0f1115; --card:#171a21; --ink:#e6e6ea; --muted:#a9abb3; --gold:#c3985a; --bad:#e5534b; --okay:#3fb950; }
  html,body { margin:0; padding:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; }
  .wrap { max-width:960px; margin:24px auto; padding:0 16px; }
  header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
  h1 { font-size:28px; margin:0; color:var(--gold); letter-spacing:.3px; }
  .card { background:var(--card); border-radius:16px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,.3); }
  .row { display:grid; grid-template-columns:1fr; gap:14px; }
  label { display:block; font-weight:600; margin-bottom:6px; }
  select, input[type="text"], input[type="email"], textarea { width:100%; background:#0d0f14; border:1px solid #2a2f3a; color:var(--ink); border-radius:10px; padding:10px 12px; outline:none; }
  textarea { min-height:96px; resize:vertical; }
  .pill { display:inline-flex; align-items:center; gap:6px; background:#0d0f14; border:1px solid #2a2f3a; border-radius:999px; padding:8px 12px; user-select:none; }
  .pill input[type="checkbox"] { appearance:auto; accent-color:var(--gold); }
  .choices { display:flex; gap:8px; flex-wrap:wrap; }
  .subtle { color:var(--muted); font-size:12px; }
  .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:16px; }
  button { background:var(--gold); color:#111; border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; }
  button.secondary { background:#0d0f14; color:var(--ink); border:1px solid #2a2f3a; }
  button.warn { background:#e5534b; color:#fff; }
  .hide { display:none !important; }
  .req { color:var(--bad); margin-left:6px; font-weight:700; }
  .inline-input { display:inline-block; width:220px; vertical-align:middle; margin-left:8px; }
  .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; padding:16px; }
  .modal { background:#12151c; border:1px solid #2a2f3a; border-radius:16px; max-width:520px; width:100%; padding:18px; box-shadow:0 10px 32px rgba(0,0,0,.4); }
  .modal h2 { margin:0 0 8px 0; color:var(--okay); }
  .modal .muted { color:var(--muted); font-size:12px; }
  .admin-note { font-size:12px; color:var(--muted); }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Illume Feedback Survey</h1>
    <div class="subtle">Choose your customer type to see relevant questions.</div>
  </header>

  <div class="card">
    <div class="row">
      <!-- Optional identity fields -->
      <div class="row">
        <div>
          <label>First name</label>
          <input id="firstName" type="text" placeholder="First name (optional)">
        </div>
        <div>
          <label>Last name</label>
          <input id="lastName" type="text" placeholder="Last name (optional)">
        </div>
        <div>
          <label>Email</label>
          <input id="email" type="email" placeholder="you@example.com (optional)">
        </div>
      </div>

      <div>
        <label for="role">Which best describes you? <span class="req">*</span></label>
        <select id="role" required>
          <option value="">Select...</option>
          <option>Magazine Advertiser</option>
          <option>Magazine Subscriber</option>
          <option>Event Attendee</option>
          <option>Event Instructor</option>
          <option>Event Vendor</option>
          <option>Learn Instructor</option>
          <option>Learn Subscriber</option>
        </select>
      </div>

      <div id="formFields" class="row"></div>

      <div class="actions">
        <button id="submitBtn">Submit Response</button>

        <!-- Admin controls hidden by default -->
        <span id="adminControls" class="hide" style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="secondary" id="exportCsvBtn">Export CSV</button>
          <button class="secondary" id="exportJsonBtn">Export JSON</button>
          <button class="secondary" id="importJsonBtn">Import JSON</button>
          <button class="warn" id="clearBtn">Clear Stored Responses</button>
          <button class="secondary" id="adminSignOut">Exit Admin</button>
        </span>
      </div>
      <div class="subtle">Responses save in this browser. Export before clearing cache or switching devices.</div>
      <div id="adminHint" class="admin-note hide">Admin mode enabled.</div>
    </div>
  </div>
</div>

<div id="backdrop" class="modal-backdrop">
  <div class="modal">
    <h2>Thanks — your response has been submitted</h2>
    <div id="confirmBody"></div>
    <p class="muted">You can close this window or submit another entry.</p>
    <div style="display:flex; gap:8px; margin-top:10px;">
      <button id="closeModal">Close</button>
      <button class="secondary" id="downloadCsvQuick">Download CSV</button>
    </div>
  </div>
</div>
<script>
// ===== Admin mode toggle =====
const ADMIN_PASSPHRASE = "sunset-saddle";
const ADMIN_FLAG_KEY = "illume_admin_mode";

function setAdminMode(on){
  localStorage.setItem(ADMIN_FLAG_KEY, on ? "1" : "0");
  document.getElementById("adminControls").classList.toggle("hide", !on);
  document.getElementById("adminHint").classList.toggle("hide", !on);
}

// Enable via Shift+A then passphrase prompt
document.addEventListener("keydown", (e)=>{
  if(e.key.toLowerCase() === "a" && e.shiftKey){
    const input = prompt("Enter admin passphrase:");
    if(input && input.trim() === ADMIN_PASSPHRASE){
      setAdminMode(true);
      alert("Admin mode enabled");
    } else if(input != null) {
      alert("Incorrect passphrase");
    }
  }
});

// Also allow URL hash: #admin=pass
(function(){
  const m = location.hash.match(/#admin=(.+)$/);
  if(m && decodeURIComponent(m[1]) === ADMIN_PASSPHRASE) setAdminMode(true);
  else setAdminMode(localStorage.getItem(ADMIN_FLAG_KEY) === "1");
})();

// ===== Sign out of Admin =====
document.addEventListener("DOMContentLoaded", ()=>{
  const btn = document.getElementById("adminSignOut");
  if(btn){
    btn.addEventListener("click", ()=>{
      localStorage.removeItem(ADMIN_FLAG_KEY);
      document.getElementById("adminControls").classList.add("hide");
      document.getElementById("adminHint").classList.add("hide");
      alert("Admin mode disabled");
    });
  }
});

// (Survey schema + rest of script unchanged — omitted for brevity in this block)
</script>
  <script>
// Put your Apps Script Web App URL here
const SHEETS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxFO4TtDoM9yHBs5Fxd7rf4ncCLbdwFC65C8eeFvZ-_NjD0c_11lU-Lp4dHHJxqzsXk/exec';

async function postToSheets(row) {
  try {
    const res = await fetch(SHEETS_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(row)
    });
    return await res.json();
  } catch (e) {
    return { ok:false, error:String(e) };
  }
}
    <script>
/* ----- Wire Submit to Google Sheets ----- */
(function wireSheetsSubmit(){
  const btn = document.getElementById("submitBtn");
  if(!btn){ console.error("submitBtn not found"); return; }

  // Remove any existing listeners by cloning the node
  const fresh = btn.cloneNode(true);
  btn.parentNode.replaceChild(fresh, btn);

  let isSubmitting = false;
  fresh.addEventListener("click", async ()=>{
    if(isSubmitting) return;
    isSubmitting = true;

    const row = validateAndCollect(); 
    if(!row){ isSubmitting = false; return; }

    // Keep local archive
    responses.push(row);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(responses));

    // Push to Google Sheets
    let result = { ok:false, error:"No endpoint set" };
    try { result = await postToSheets(row); } catch(e){ result = { ok:false, error:String(e) }; }

    const who = [row.first_name, row.last_name].filter(Boolean).join(" ");
    const statusLine = result.ok ? "Saved to Sheets" : "Saved locally only";
    const extra = result.ok 
      ? `<br><strong>Sheets time:</strong> ${result.stored_at || ""}` 
      : `<br><strong>Warning:</strong> ${result.error || "Offline or blocked"}`;

    const summary = `<p><strong>Submitted</strong> at ${new Date(row._ts).toLocaleString()}`
      + `<br><strong>Customer type:</strong> ${row.role}`
      + `${who ? "<br><strong>Name:</strong> " + who : ""}`
      + `${row.email ? "<br><strong>Email:</strong> " + row.email : ""}`
      + `<br><strong>Status:</strong> ${statusLine}${extra}</p>`;
    openModal(summary);

    // Reset visible controls
    formFields.querySelectorAll("select").forEach(s=>s.value="");
    formFields.querySelectorAll("textarea").forEach(t=>t.value="");
    formFields.querySelectorAll(".choices input[type=checkbox]").forEach(c=>c.checked=false);
    formFields.querySelectorAll(".inline-input").forEach(t=>{ t.value=""; t.classList.add("hide"); });

    isSubmitting = false;
  });
})();
</script>
</script>
</body>
</html>
